<html>

<head>
    <style>
        .textbox {
            position: absolute;
            border: 1px solid black;
            padding: 5px;
            resize: both;
            overflow: auto;
            /* required for resize to work */
        }

        .buttons {
            display: none;
            position: absolute;
        }

        .textbox_button {
            width: 6vh;
            height: 6vh;
            background: white;
            border: solid black 0.25vh;
            margin-left: 1px;
        }
    </style>
</head>

<body>
    <div class="textbox_container">
        <div class="buttons">
            <button class="textbox_button" id="move" style="cursor: move;">Move Textbox</button>
            <button class="textbox_button" id="increase">Increase font size</button>
            <button class="textbox_button" id="decrease">Decrease font size</button>
            <button class="textbox_button" id="bold">Bold</button>
            <button class="textbox_button" id="italic">Italic</button>
            <button class="textbox_button" id="underline">Underline</button>
            <input class="textbox_button" type="color" id="colorPicker" value="#000000">
        </div>
        <div class="textbox" contenteditable="true"> This is a movable textbox</div>
    </div>
    <script>
        // Make the textbox movable
        const textbox = document.querySelector('.textbox');
        const buttons = document.querySelector('.buttons');
        let offsetX = 0;
        let offsetY = 0;
        let isMovingMode = false;
        const buttonIds = ['bold', 'italic', 'underline', 'color', 'increase', 'decrease', 'move'];
        const [boldButton, italicButton, underlineButton, colorButton, increaseButton, decreaseButton, moveButton] =
        buttonIds.map(id => document.getElementById(id));
        let fontSize = 16; // initial font size

        function changeFontSize(size) {
            const selection = window.getSelection();
            if (!selection.rangeCount) return;
            let range = selection.getRangeAt(0);
            let span = document.createElement('span');
            span.style.fontSize = `${size}px`;
            span.textContent = range.toString();
            range.deleteContents();
            range.insertNode(span);
        }


        moveButton.addEventListener('mousedown', (e) => {
            e.preventDefault(); // prevent the mousedown event from causing the textbox to lose focus
            isMovingMode = true;
        });

        // Update the mouseup event listener for the move button
        moveButton.addEventListener('mouseup', () => {
            isMovingMode = false;
        });

        // Update the mousemove event listener
        document.addEventListener('mousemove', (e) => {
            if (isMovingMode) {
                textbox.style.left = `${e.clientX - offsetX}px`;
                textbox.style.top = `${e.clientY - offsetY}px`;

                // Move the buttons also
                buttons.style.left = `${e.clientX - offsetX}px`;
                buttons.style.top = `${e.clientY - offsetY - buttons.offsetHeight}px`;
            }
        });

        // Update the mousedown event listener for the textbox
        moveButton.addEventListener('mousedown', (e) => {
            const rect = textbox.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
        });




        // Show buttons when textbox is selected
        textbox.addEventListener('focus', () => {
            buttons.style.display = 'flex';
            const rect = textbox.getBoundingClientRect();
            buttons.style.left = `${rect.left}px`;
            buttons.style.top = `${rect.top - buttons.offsetHeight}px`;
        });

        textbox.addEventListener('blur', () => {
            buttons.style.display = 'none';
        });

        increaseButton.addEventListener('mousedown', (e) => {
            e.preventDefault(); // prevent the mousedown event from causing the textbox to lose focus
        });

        decreaseButton.addEventListener('mousedown', (e) => {
            e.preventDefault(); // prevent the mousedown event from causing the textbox to lose focus
        });
        boldButton.addEventListener('mousedown', (e) => {
            e.preventDefault(); // prevent the mousedown event from causing the textbox to lose focus
        });

        italicButton.addEventListener('mousedown', (e) => {
            e.preventDefault(); // prevent the mousedown event from causing the textbox to lose focus
        });
        underlineButton.addEventListener('mousedown', (e) => {
            e.preventDefault(); // prevent the mousedown event from causing the textbox to lose focus
        });

        increaseButton.addEventListener('click', () => {
            fontSize++;
            changeFontSize(fontSize);
        });

        decreaseButton.addEventListener('click', () => {
            fontSize--;
            changeFontSize(fontSize);
        });

        boldButton.addEventListener('click', () => {
            document.execCommand('bold', false, null);
        });

        italicButton.addEventListener('click', () => {
            document.execCommand('italic', false, null);
        });

        underlineButton.addEventListener('click', () => {
            document.execCommand('underline', false, null);
        });

        // Add this in the JavaScript
        const colorPicker = document.getElementById('colorPicker');

        colorPicker.addEventListener('input', () => {
            document.execCommand('foreColor', false, colorPicker.value);
        });

        colorPicker.addEventListener('mousedown', (e) => {
            e.preventDefault(); // prevent the mousedown event from causing the textbox to lose focus
        });
    </script>
</body>

</html>